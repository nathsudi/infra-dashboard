{% extends 'base.html' %}

{% block title %}Cluster Dashboard{% endblock %}

{% block content %}
<h1>Cluster Dashboard</h1>
<button id="load-data-btn">Load Data</button>
<table id="clusters-table">
    <thead>
        <tr>
            <th>Orchestrator Platform</th>
            <th>Setup</th>
            <th>Cluster Name</th>
            <th>Cluster FQDN</th>
            <th>Orchestrator Version</th>
            <th>Cluster Runtime</th>
            <th>Jump Host</th>
            <th>Edge Nodes</th>
        </tr>
    </thead>
    <tbody>
        {% for cluster in clusters %}
        <tr id="cluster-{{ loop.index0 }}">
            <td>{{ cluster['orch-plat'] }}</td>
            <td>{{ cluster['setup'] }}</td>
            <td>{{ cluster['cluster-name'] }}</td>
            <td>{{ cluster['cluster-fqdn'] }}</td>
            <td class="orch-ver">Loading...</td>
            <td class="cluster-runtime">Loading...</td>
            <td>{{ cluster['jump-host'] }}</td>
            <td class="edge-nodes">Loading...</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    document.getElementById('load-data-btn').addEventListener('click', function() {
        fetch('{{ url_for("cluster.api_clusters_dynamic_data") }}')
            .then(response => response.json())
            .then(data => {
                data.forEach((cluster, index) => {
                    const row = document.getElementById('cluster-' + index);
                    row.querySelector('.orch-ver').textContent = cluster['orch-ver'];
                    row.querySelector('.cluster-runtime').textContent = cluster['cluster-runtime'];
                    const edgeNodesCell = row.querySelector('.edge-nodes');
                    edgeNodesCell.innerHTML = cluster['edge-nodes'].map(edgeNode =>
                        `<a href="${edgeNode.url}">${edgeNode.id}</a>`
                    ).join(', ');
                });
            })
            .catch(error => {
                console.error('Error loading dynamic data:', error);
            });
    });
</script>
{% endblock %}